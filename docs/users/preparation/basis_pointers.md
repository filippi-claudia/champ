---
title: Basis Pointers
tags:
    - basis
    - atomic orbitals
    - basis info
---

# Basis Pointers

Basis pointer files (formerly called `bfinfo` files) provide the mapping between atomic orbitals and the radial basis functions stored in the numerical basis files. They specify how to construct atomic orbitals from radial shells and angular momentum functions, enabling CHAMP to build molecular orbitals from the atomic basis.

## Overview

The basis pointer file acts as an instruction manual for assembling atomic orbitals:

- Maps radial shells to angular momentum components
- Defines the number and type of atomic orbitals per atom
- Links atomic orbitals to columns in the radial grid files
- Organizes basis functions by angular momentum quantum numbers

### Key Concepts

- **Atomic orbital (AO)**: A single-atom basis function with specific angular character
- **Radial shell**: A radial basis function from the `.basis` file
- **Angular momentum index**: Specifies spherical harmonic $Y_l^m$ or real harmonic $S_l^m$
- **Column mapping**: Links AOs to specific columns in the radial basis file

## File Format

Basis pointer files are stored in the `pool/` directory and are automatically generated by the `trex2champ` converter.

### File Structure

```python
# Format of the new basis information file champ_v3
# num_ao_per_center, n(s), n(p), n(d), n(f), n(g)
# Index of Slm (Range 1 to 35)
# Index of column from numerical basis file
qmc_bf_info 1
54 4 4 3 2 0
1 1 1 1 2 3 4 2 3 4 2 3 4 2 3 4 5 6 7 8 9 10 5 6 7 8 9 10 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 11 12 13 14 15 16 17 18 19 20
1 2 3 4 5 5 5 6 6 6 7 7 7 8 8 8 9 9 9 9 9 9 10 10 10 10 10 10 11 11 11 11 11 11 12 12 12 12 12 12 12 12 12 12 13 13 13 13 13 13 13 13 13 13
35 4 3 2 1 0
1 1 1 1 2 3 4 2 3 4 2 3 4 5 6 7 8 9 10 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20
1 2 3 4 5 5 5 6 6 6 7 7 7 8 8 8 8 8 8 9 9 9 9 9 9 10 10 10 10 10 10 10 10 10 10
end
```

### Format Specification

**Header line**: Format identifier
```python
qmc_bf_info 1
```
Identifies this as a basis pointer file in CHAMP v3 format.

**For each unique atom type**: Three consecutive lines

**Line 1**: Angular momentum composition
```python
54 4 4 3 2 0
```
Format: `num_ao_per_center  n(s)  n(p)  n(d)  n(f)  n(g)`

- `num_ao_per_center` = 54: Total number of atomic orbitals for this atom
- `n(s)` = 4: Number of s-type radial shells (l=0)
- `n(p)` = 4: Number of p-type radial shells (l=1)
- `n(d)` = 3: Number of d-type radial shells (l=2)
- `n(f)` = 2: Number of f-type radial shells (l=3)
- `n(g)` = 0: Number of g-type radial shells (l=4)

Total AOs = n(s)×1 + n(p)×3 + n(d)×5 + n(f)×7 + n(g)×9
           = 4×1 + 4×3 + 3×5 + 2×7 + 0×9 = 4 + 12 + 15 + 14 + 0 = 45... (wait, example shows 54, likely includes higher terms)

**Line 2**: Angular momentum indices
```python
1 1 1 1 2 3 4 2 3 4 2 3 4 2 3 4 5 6 7 8 9 10 5 6 7 8 9 10 ...
```

Each number is an index for a real spherical harmonic $S_l^m$ (range 1-35):

| Index | Angular | Description |
|-------|---------|-------------|
| 1 | $S_0^0$ | s orbital |
| 2-4 | $S_1^{-1,0,1}$ | p orbitals (px, py, pz) |
| 5-9 | $S_2^{-2,...,2}$ | d orbitals |
| 10-16 | $S_3^{-3,...,3}$ | f orbitals |
| 17-25 | $S_4^{-4,...,4}$ | g orbitals |
| 26-35 | $S_5^{-5,...,5}$ | h orbitals |

The sequence maps each AO to its angular component.

**Line 3**: Radial shell column indices
```python
1 2 3 4 5 5 5 6 6 6 7 7 7 8 8 8 9 9 9 9 9 9 10 10 10 10 10 10 ...
```

Each number specifies which column (radial shell) from the `.basis` file to use for the corresponding AO:

- Column indices start at 1 (after the radius column)
- Multiple AOs can share the same radial shell (different angular components)
- The length of this line equals `num_ao_per_center`

**Final line**:
```
end
```

## Examples

### Example 1: Hydrogen Atom (Simple)

**Basis pointer file** (`basis_pointers`):
```python
qmc_bf_info 1
4 2 1 0 0 0
1 1 2 3 4
1 2 3 3 3
end
```

**Explanation**:

- **Line 1**: `4 2 1 0 0 0`
  - 4 total AOs
  - 2 s-type shells (1s, 2s)
  - 1 p-type shell (2p)
  - No d, f, or g shells
  
- **Line 2**: `1 1 2 3 4`
  - AOs 1-2: s-type (index 1)
  - AO 3: px (index 2)
  - AO 4: py (index 3)
  - AO 5: pz (index 4)
  
- **Line 3**: `1 2 3 3 3`
  - AO 1: uses radial shell 1 (1s)
  - AO 2: uses radial shell 2 (2s)
  - AOs 3-4: all use radial shell 3 (2p with different angular parts)

### Example 2: Carbon Atom (BFD-T Basis)

**Basis pointer file**:
```python
qmc_bf_info 1
9 2 2 1 0 0
1 1 2 3 4 2 3 4 5 6 7 8 9
1 2 3 3 3 4 4 4 5 5 5 5 5
end
```

**Explanation**:

- **9 atomic orbitals** total
- **2 s-shells**: 1s and 2s
- **2 p-shells**: 2p and 3p (or polarization p)
- **1 d-shell**: 3d (polarization)

**Angular momentum breakdown**:
- 2 s-orbitals (indices 1, 1)
- 6 p-orbitals (indices 2-4 twice for two p-shells)
- 5 d-orbitals (indices 5-9)

**Radial shell mapping**:
- Columns 1-2: s-type radials
- Columns 3-4: p-type radials
- Column 5: d-type radials

### Example 3: Water Molecule (Multi-atom)

**Geometry**: O, H, H (two unique atom types)

**Basis pointer file**:
```python
qmc_bf_info 1
14 3 2 1 0 0
1 1 1 2 3 4 2 3 4 5 6 7 8 9
1 2 3 4 4 4 5 5 5 6 6 6 6 6
5 2 1 0 0 0
1 1 2 3 4
1 2 3 3 3
end
```

**Explanation**:

**First atom type (Oxygen)**:
- 14 AOs: 3 s-shells + 2 p-shells + 1 d-shell
- s-orbitals use radial columns 1, 2, 3
- p-orbitals use radial columns 4, 5
- d-orbitals use radial column 6

**Second atom type (Hydrogen)**:
- 5 AOs: 2 s-shells + 1 p-shell
- s-orbitals use radial columns 1, 2
- p-orbitals use radial column 3

### Example 4: Heavy Element with f-functions

**Transition metal with extended basis**:
```python
qmc_bf_info 1
30 3 3 2 1 0
1 1 1 2 3 4 2 3 4 2 3 4 5 6 7 8 9 5 6 7 8 9 10 11 12 13 14 15 16
1 2 3 4 4 4 5 5 5 6 6 6 7 7 7 7 7 8 8 8 8 8 9 9 9 9 9 9 9
end
```

**Explanation**:

- 30 total AOs
- 3 s-shells, 3 p-shells, 2 d-shells, 1 f-shell
- f-orbitals (7 functions) use indices 10-16
- Radial columns 1-9 used for all shells

## Angular Momentum Indexing

### Real Spherical Harmonics

CHAMP uses real spherical harmonics $S_l^m$ (linear combinations of $Y_l^m$):

**s-orbitals (l=0)**:
- Index 1: $S_0^0$

**p-orbitals (l=1)**:
- Index 2: $S_1^{-1}$ (py)
- Index 3: $S_1^0$ (pz)
- Index 4: $S_1^{1}$ (px)

**d-orbitals (l=2)**:
- Index 5: $S_2^{-2}$ (dxy)
- Index 6: $S_2^{-1}$ (dyz)
- Index 7: $S_2^0$ (d3z²-r²)
- Index 8: $S_2^{1}$ (dxz)
- Index 9: $S_2^{2}$ (dx²-y²)

**f-orbitals (l=3)**:
- Indices 10-16: Seven f-type functions

**g-orbitals (l=4)**:
- Indices 17-25: Nine g-type functions

### Counting Atomic Orbitals

Total AOs per atom:

$$\text{Total AOs} = \sum_{l} n(l) \times (2l + 1)$$

where $n(l)$ is the number of radial shells for angular momentum $l$.

**Example**: 
- 3 s-shells (l=0): 3 × 1 = 3 AOs
- 2 p-shells (l=1): 2 × 3 = 6 AOs  
- 1 d-shell (l=2): 1 × 5 = 5 AOs
- **Total**: 3 + 6 + 5 = 14 AOs

## Loading Basis Pointers in CHAMP

The basis pointer file is loaded automatically when you specify the basis set:

```perl
%module general
    title  'VMC calculation'
    pool   './pool/'
    basis  'BFD-T'
%endmodule

load trexio   $pool/molecule.hdf5
```

CHAMP looks for `basis_pointers` file in the `pool/` directory.

### Explicit Loading

You can also load the file explicitly:

```perl
load basis_num_info  $pool/basis_pointers
```

## Generating Basis Pointer Files

### Automatic Generation

The `trex2champ` converter creates basis pointer files automatically:

```bash
trex2champ molecule.hdf5
```

This generates:
- `basis_pointers` file in correct format
- Consistent with basis set files and molecular orbitals
- Properly ordered for all atom types

### Verification

Check that the basis pointer file:

1. **Matches atom types**: One set of 3 lines per unique atom
2. **Consistent AO counts**: Sum of angular components equals total AOs
3. **Valid angular indices**: All indices in range 1-35
4. **Valid column indices**: Don't exceed number of radial shells in `.basis` file

## Common Issues

### Incorrect AO Count

**Error**:
```
ERROR: Number of AOs (45) doesn't match angular momentum sum (54)
```

**Solution**: Verify the angular momentum counts n(s), n(p), n(d), n(f), n(g) add up correctly using the formula $\sum n(l) \times (2l+1)$.

### Column Index Out of Range

**Error**:
```
ERROR: Column index 15 exceeds basis file columns (9)
```

**Solution**: Ensure radial shell indices (line 3) don't exceed the number of shells in the corresponding `.basis` file.

### Missing Atom Type

**Error**:
```
ERROR: Basis pointers found for 1 atom types, but geometry has 2
```

**Solution**: Add pointer entries for all unique atom types in your geometry.

### Angular Momentum Mismatch

**Error**:
```
WARNING: d-orbitals requested but basis only has s and p shells
```

**Solution**: Ensure the basis set has sufficient angular momentum. Check that `.basis` file includes required shells.

## Advanced Topics

### Contracted vs. Primitive Functions

- **Primitive functions**: Individual Gaussian or Slater functions
- **Contracted functions**: Linear combinations of primitives

CHAMP handles contraction internally; basis pointers work at the contracted level.

### Spherical vs. Cartesian

CHAMP uses **spherical harmonics** (5 d-functions, 7 f-functions) rather than Cartesian (6 d-functions, 10 f-functions). This is why d-shells contribute 5 AOs each.

### Ordering Convention

The angular momentum indices follow the CHAMP convention for real spherical harmonics. Different quantum chemistry codes may use different orderings; `trex2champ` handles the conversion.

## Best Practices

### File Organization

- Keep `basis_pointers` in the `pool/` directory
- Use `trex2champ` for reliable generation
- Verify consistency with basis set files
- Document any manual modifications

### Verification Checklist

- [ ] Total AO count matches angular momentum breakdown
- [ ] Column indices are within range for basis files
- [ ] Angular momentum indices are valid (1-35)
- [ ] Number of atom type entries matches geometry
- [ ] Atom type ordering matches geometry file

### Debugging Strategy

1. Check basis pointer format line by line
2. Verify against basis set file structure
3. Count AOs manually and compare
4. Test with simple systems first
5. Use `trex2champ` output as reference

## Related Topics

- [Basis Sets](basis.md) - Radial grid files that pointers reference
- [Molecular Orbitals](orbitals.md) - Built from atomic orbitals
- [TREXIO Files](using_trexio_file.md) - Source of basis set information
- [Preparation Workflow](index.md) - Complete input preparation

## Getting Help

- Always use `trex2champ` to generate basis pointer files
- Verify file structure matches specification exactly
- Check that angular momentum counts are consistent
- Ensure column indices correspond to existing radial shells
- Test with known working examples before custom modifications
- Consult [Troubleshooting Guide](../troubleshooting/index.md) for common errors

!!! warning "Atom Type Consistency"
    Each unique atom type in your geometry must have a corresponding set of three lines in the basis pointer file. The ordering must match the atom type ordering in your geometry and other input files.

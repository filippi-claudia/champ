name: Self-hosted Intel OneAPI Build and Testing on ccpgate/ccp01

on:
  push:
    branches:
      - 'releases/**'
      - main
      - rmax
      - debug_intel
      - feature/debug-ci
      - optimization
    # Sequence of patterns matched against refs/tags
    tags:
      - v2.*.*
  pull_request:
    branches:
      - 'releases/**'
      - main
      - rmax
      - cartesian_d
      - cartesian_d_qmckl
      - debug_intel
      - optimization
      - feature/debug-ci

jobs:
  build_champ:
    name: Build CHAMP with Intel OneAPI self-hosted runner ccpgate/ccp01
    runs-on: self-hosted
    timeout-minutes: 120
    # continue-on-error: true
    defaults:
      run:
        shell: bash --noprofile --norc {0}
    steps:
    - uses: actions/checkout@v2
    - name: Compile the CHAMP code
      run: |
        module load compiler-rt/latest compiler/latest icc/latest mkl/latest mpi/latest python3/latest tbb/latest
        module load hdf5/1.12.1-intel trexio/2.0.0-intel
        which mpirun
        export LD_LIBRARY_PATH=/software/intel/oneapi/mkl/latest/lib/intel64:/software/intel/oneapi/mpi/latest/lib:/software/intel/oneapi/intelpython/python3.7/lib:$LD_LIBRARY_PATH
        /software/cmake-3.22.1/bin/cmake --version
        /software/cmake-3.22.1/bin/cmake -H. -Bbuild -DCMAKE_Fortran_COMPILER=mpiifort -DCMAKE_C_COMPILER=mpiicc -DBLA_STATIC=ON -DBLA_VENDOR=Intel10_64lp
        /software/cmake-3.22.1/bin/cmake --build build -- -j2

    - name: "Test 01 (H2) sto basis optimize jastrow sr_n method on 1 processor"
      run: |
        echo "Running the testsuite:: Test : . H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc.inp -o revised_vmc_single.out -e error

        echo "Comparing the energy with the reference one (total E = -1.0152558 +-  0.0067031) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_single.out "total E" -1.0152558  0.0067031

    - name: "Test 02 (H2) sto basis optimize jastrow sr_n method on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc.inp -o revised_vmc_double.out -e error

        echo "Comparing the energy with the reference one (total E = -1.0055746 +-  0.0047353) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_double.out "total E" -1.0055746  0.0047353

    - name: "Test 03 (H2) sto basis optimize wf+jastrow using lin_d method on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc_davidson_check.inp -o revised_vmc_davidson_check_single.out -e error

        echo "Comparing the energy with the reference one (total E = -1.0583032 +-  0.0034701) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_davidson_check_single.out "total E" -1.0583032   0.0034701

    - name: "Test 04 (H2) sto basis optimize wf+jastrow using lin_d method on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc_davidson_check.inp -o revised_vmc_davidson_check_double.out -e error

        echo "Comparing the energy with the reference one (total E = -1.0586579 +-  0.0020902) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_davidson_check_double.out "total E" -1.0586579   0.0020902

    - name: "Test 05 (H2) sto basis optimize wf+jastrow using lin_d method nopt_iter=20 on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc_lin.inp -o revised_vmc_lin_single.out -e error

        echo "Comparing the energy with the reference one (total E = -1.0537256 +-  0.0031706 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_lin_single.out "total E" -1.0537256   0.0031706

    - name: "Test 06 (H2) sto basis optimize wf+jastrow using lin_d method nopt_iter=20  on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc_lin.inp -o revised_vmc_lin_double.out -e error

        echo "Comparing the energy with the reference one (total E = -1.0613946 +-  0.0030179) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_lin_double.out "total E" -1.0613946  0.0030179

    - name: "Test 07 (H2) corsamp :: sto basis optimize wf+ci+jastrow using linear method nopt_iter=5 on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc_corsamp.inp -o revised_vmc_corsamp_single.out -e error

        echo "Comparing the energy with the reference one (Current energy = -1.0024307 +-   0.0096179 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_corsamp_single.out "Current energy" -1.0024307   0.0096179

        echo "Comparing the energy with the reference one Current best energy + 2*error = -0.9938"
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_corsamp_single.out "Current best energy + 2*error" -0.9938 0.0096179

    - name: "Test 08 (H2) corsamp :: sto basis optimize wf+ci+jastrow using linear method nopt_iter=5 on 2 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc_corsamp.inp -o revised_vmc_corsamp_double.out -e error

        echo "Comparing the energy with the reference one (Current energy = -1.0103609 +-   0.0071534 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_corsamp_double.out "Current energy" -1.0103609  0.0071534

        echo "Comparing the energy with the reference one Current best energy + 2*error = -0.9961"
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_corsamp_double.out "Current best energy + 2*error" -0.9961 0.0071534


    - name: "Test 09 (Butadiene) Workload DMC on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the DMC tests using the new parser. Butadiene DMC from workload single core"
        cd tests/CI_test/DMC-Butadiene-ci1010_pVTZ-500-dets

        echo "Running the dmc.mov1 on one processor"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/dmc.mov1 -i dmc.inp  -o dmc_workload_single.out  -e dmc_single_core.error

        echo "Comparing the energy with the reference one (total energy (  100) = -26.2726706 +-  0.0155477) "
        $GITHUB_WORKSPACE/tools/compare_value.py dmc_workload_single.out "total energy (  100)" -26.2726706   0.0155477


    - name: "Test 10 (Butadiene) Workload DMC on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the DMC tests using the new parser. Butadiene DMC  from workload two cores"
        cd tests/CI_test/DMC-Butadiene-ci1010_pVTZ-500-dets

        echo "Running the dmc.mov1 on two processors"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/dmc.mov1 -i dmc.inp  -o dmc_workload_double.out  -e dmc_double_core.error

        echo "Comparing the energy with the reference one (total energy (  100) = -26.2756576 +-  0.0115056) "
        $GITHUB_WORKSPACE/tools/compare_value.py dmc_workload_double.out "total energy (  100)" -26.2756576   0.0115056



    - name: "Test 11 (Butadiene cas44) VMC only on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene/ci44_pVQZ_20_dets_12_csf_noopt

        echo "Running the calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_noopt_ci44.inp  -o vmc_noopt_ci44_single.out  -e error

        echo "Comparing the energy with the reference one (total E = -26.2319580 +-  0.0154935) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_noopt_ci44_single.out "total E" -26.2319580   0.0154935


    - name: "Test 12 (Butadiene cas44) VMC only on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene/ci44_pVQZ_20_dets_12_csf_noopt

        echo "Running the calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_noopt_ci44.inp  -o vmc_noopt_ci44_double.out  -e error

        echo "Comparing the energy with the reference one (total E = -26.2413352 +-  0.0099707) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_noopt_ci44_double.out "total E" -26.2413352   0.0099707


    - name: "Test 13 (Butadiene) VMC optimization + node cutoff including geometry and csfmap using sr_n (500 determinants) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene/ci44_pVQZ_20_dets_12_csf_optall

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optall_ci44.inp  -o vmc_optall_ci44_single.out  -e error

        echo "Comparing the energy with the reference one (total E = -26.1927511 +-  0.0153869) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optall_ci44_single.out "total E" -26.1927511   0.0153869

    - name: "Test 14 (Butadiene) VMC optimization + node cutoff including geometry and csfmap using sr_n (500 determinants) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene/ci44_pVQZ_20_dets_12_csf_optall

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optall_ci44.inp  -o vmc_optall_ci44_double.out  -e error

        echo "Comparing the energy with the reference one (total E = -26.2326774 +-  0.0098481) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optall_ci44_double.out "total E" -26.2326774   0.0098481


    - name: "Test 15 (Butadiene) Workload VMC optimization all using sr_n (500 determinants) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-ci1010_pVTZ-500-dets

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_500.inp  -o vmc_optimization_500_single.out  -e error_vmc_optimization_500

        echo "Comparing the energy with the reference one (total E = -26.1534618 +-  0.0339620) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_500_single.out "total E" -26.1534618  0.0339620


    - name: "Test 16 (Butadiene) Workload VMC optimization all using sr_n (500 determinants) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-ci1010_pVTZ-500-dets

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_500.inp  -o vmc_optimization_500_double.out  -e error_vmc_optimization_500

        echo "Comparing the energy with the reference one (total E = -26.1908783 +-  0.0184096 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_500_double.out "total E" -26.1908783  0.0184096


    - name: "Test 17 (Butadiene) Workload VMC optimization all using sr_n (5000 determinants) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-ci1010_pVTZ-5000-dets

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_5000.inp  -o vmc_optimization_5000_single.out  -e error_vmc_optimization_5000

        echo "Comparing the energy with the reference one (total E = -26.2667703 +-  0.0202979) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_5000_single.out "total E" -26.2667703   0.0202979


    - name: "Test 18 (Butadiene) Workload VMC optimization all using sr_n (5000 determinants) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-ci1010_pVTZ-5000-dets

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_5000.inp  -o vmc_optimization_5000_double.out  -e error_vmc_optimization_5000

        echo "Comparing the energy with the reference one (total E = -26.1885562 +-  0.0217743) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_5000_double.out "total E" -26.1885562  0.0217743

    - name: "Test 19 (Butadiene) Workload VMC optimization all using sr_n (15000 determinants) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-ci1010_pVTZ-15000-dets

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_15000.inp  -o vmc_optimization_15000_single.out  -e error_vmc_optimization_15000

        echo "Comparing the energy with the reference one (total E = -26.1840650 +-  0.0228883) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_15000_single.out "total E" -26.1840650   0.0228883

    - name: "Test 20 (Butadiene) Workload VMC optimization all using sr_n (15000 determinants) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-ci1010_pVTZ-15000-dets

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_15000.inp  -o vmc_optimization_15000_double.out  -e error_vmc_optimization_15000

        echo "Comparing the energy with the reference one (total E = -26.2385621 +-  0.0154218) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_15000_double.out "total E" -26.2385621   0.0154218

    - name: "Test 21 (Butadiene) Workload VMC optimization all using sr_n (15000 determinants with 3body Jastrow) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-ci1010_pVTZ-15000-dets-3body-jastrow

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_15000_3body.inp  -o vmc_optimization_15000_3body_single.out  -e error_vmc_optimization_15000_3body

        echo "Comparing the energy with the reference one (total E = -26.1840650 +-  0.0228883) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_15000_3body_single.out "total E" -26.1840650  0.0228883


    - name: "Test 22 (Butadiene) Workload VMC optimization all using sr_n (15000 determinants with 3body Jastrow) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-ci1010_pVTZ-15000-dets-3body-jastrow

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_15000_3body.inp  -o vmc_optimization_15000_3body_double.out  -e error_vmc_optimization_15000_3body

        echo "Comparing the energy with the reference one (total E = -26.2385621 +-  0.0154218) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_15000_3body_double.out "total E" -26.2385621   0.0154218

    - name: "Test 23 (Butadiene) Workload VMC optimization all using sr_n (65000 dets) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-ras1022_Q_optWF+geo-64000dets

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_opt_ras1022_pVQZ_65000.inp  -o vmc_opt_ras1022_pVQZ_65000_single.out  -e error

        echo "Comparing the energy with the reference one (total E = -26.1318076 +-  0.0301028) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_opt_ras1022_pVQZ_65000_single.out "total E" -26.1318076   0.0301028

    - name: "Test 24 (Butadiene) Workload VMC optimization all using sr_n (65000 dets) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-ras1022_Q_optWF+geo-64000dets

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_opt_ras1022_pVQZ_65000.inp  -o vmc_opt_ras1022_pVQZ_65000_double.out  -e error

        echo "Comparing the energy with the reference one (total E = -26.1072384 +-  0.0181633 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_opt_ras1022_pVQZ_65000_double.out "total E" -26.1072384   0.0181633


    - name: "Test 25 (psb3) optimize wavefunction and ci using sr_n (400 determinants, 2 states, csfmap) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . PSB3 sr_n"
        cd tests/CI_test/VMC-PSB3-400_dets-175_csfs_ci66_BFD-Da

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_sr_n.inp -o revised_sr_n_single.out -e error

        echo "Comparing the energy with the reference one (total E of second state = -42.5504779 +-  0.0464915 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_sr_n_single.out "total E" -42.5504779   0.0464915

    - name: "Test 26 (psb3) optimize wavefunction and ci using sr_n (400 determinants, 2 states, csfmap) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . PSB3 sr_n"
        cd tests/CI_test/VMC-PSB3-400_dets-175_csfs_ci66_BFD-Da

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_sr_n.inp -o revised_sr_n_double.out -e error

        echo "Comparing the energy with the reference one (total E of second state = -42.5941598 +-  0.0343163 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_sr_n_double.out "total E" -42.5941598   0.0343163


    - name: "Test 27 (psb3) optimize wavefunction and ci using lin_d method Regterg Calculation (400 determinants, 2 states, csfmap) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . PSB3 lin_d regterg "
        cd tests/CI_test/VMC-PSB3-400_dets-175_csfs_ci66_BFD-Da

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_regterg.inp -o revised_regterg_single.out -e error

        echo "Comparing the energy with the reference one (total E of second state = -41.3716901 +-  0.0607036 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_regterg_single.out "total E" -41.3716901  0.0607036

    # - name: "Test 28 (psb3) optimize wavefunction and ci using lin_d method Regterg Calculation (400 determinants, 2 states, csfmap) on 2 processors"
    #   run: |
    #     ulimit -s unlimited
    #     echo "Running the testsuite:: Test : . PSB3 lin_d regterg "
    #     ulimit -s unlimited
    #     cd tests/CI_test/VMC-PSB3-400_dets-175_csfs_ci66_BFD-Da

    #     echo "Running the optimization calculation"
    #     /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_regterg.inp -o revised_regterg_double.out -e error

    #     echo "Comparing the energy with the reference one (total E of second state = -41.5146982 +-  0.642114  ) "
    #     $GITHUB_WORKSPACE/tools/compare_value.py revised_regterg_double.out "total E" -41.5146982  0.642114


    - name: "Test 29 (psb2) optimize wfn, ci, jas, and orb using mix_n method on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . PSB2 "
        cd tests/CI_test/VMC-PSB2-36_dets-20_csfs_ci44_BFD-Da

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_psb2_mix_n.inp -o revised_psb2_mix_n_single.out -e error

        echo "Comparing the energy with the reference one ("total E" -29.8223055 +-  0.0434442) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_psb2_mix_n_single.out "total E" -29.8223055   0.0434442


    - name: "Test 30 (psb2) optimize wfn, ci, jas, and orb using mix_n method on 2 processor"
      run: |
        ulimit -s unlimited
        echo "Running the testsuite:: Test : . PSB2 "
        cd tests/CI_test/VMC-PSB2-36_dets-20_csfs_ci44_BFD-Da

        echo "Running the optimization calculation"
        /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_psb2_mix_n.inp -o revised_psb2_mix_n_double.out -e error

        echo "Comparing the energy with the reference one ("total E" -29.7013541 +-  0.0312926) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_psb2_mix_n_double.out "total E" -29.7013541   0.0312926

    # # - name: "Test 31 (Butadiene) TREXIO interface testing with HDF5 backend on 1 processor"
    # #   run: |
    # #     ulimit -s unlimited
    # #     echo "Running the testsuite:: Test : . Butadiene VMC 500 dets"
    # #     cd tests/CI_test/TREXIO

    # #     echo "Running the calculation with trexio library linked"
    # #     /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_500_hdf5.inp  -o vmc_optimization_500_hdf5_single.out  -e error

    # #     echo "Comparing the energy with the reference one (total E = -26.2164721 +-  0.0280294) "
    # #     $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_500_hdf5_single.out "total E" -26.2164721  0.0280294

    # # - name: "Test 32 (Butadiene) TREXIO interface testing with HDF5 backend on 2 processor"
    # #   run: |
    # #     ulimit -s unlimited
    # #     echo "Running the testsuite:: Test : . Butadiene VMC 500 dets"
    # #     cd tests/CI_test/TREXIO

    # #     echo "Running the calculation with trexio library linked"
    # #     /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_500_hdf5.inp  -o vmc_optimization_500_hdf5_double.out  -e error

    # #     echo "Comparing the energy with the reference one (total E = -26.1862817 +-  0.0180068) "
    # #     $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_500_hdf5_double.out "total E" -26.1862817  0.0180068

    # # - name: "Test 33 (Butadiene) TREXIO interface testing with TEXT backend on 1 processor"
    # #   run: |
    # #     ulimit -s unlimited
    # #     echo "Running the testsuite:: Test : . Butadiene VMC 500 dets"
    # #     cd tests/CI_test/TREXIO

    # #     echo "Running the calculation with trexio library linked"
    # #     /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_500_text.inp  -o vmc_optimization_500_text_single.out  -e error

    # #     echo "Comparing the energy with the reference one (total E = -26.2164721 +-  0.0280294) "
    # #     $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_500_text_single.out "total E" -26.2164721  0.0280294

    # # - name: "Test 32 (Butadiene) TREXIO interface testing with TEXT backend on 2 processor"
    # #   run: |
    # #     ulimit -s unlimited
    # #     echo "Running the testsuite:: Test : . Butadiene VMC 500 dets"
    # #     cd tests/CI_test/TREXIO

    # #     echo "Running the calculation with trexio library linked"
    # #     /software/intel/oneapi/mpi/2021.4.0//bin/mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_500_text.inp  -o vmc_optimization_500_text_double.out  -e error

    # #     echo "Comparing the energy with the reference one (total E = -26.1862817 +-  0.0180068) "
    # #     $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_500_text_double.out "total E" -26.1862817  0.0180068


    # - name: "Zip the test reults"
    #   run: |
    #     echo "Compressing the test results from workflow"
    #     cd tests/
    #     tar -czvf workflow_artifacts.tar.gz CI_test/

    # - name: Upload calculation result artifacts
    #   uses: actions/upload-artifact@v2
    #   with:
    #     name: results-workflow-actions
    #     path: tests/workflow_artifacts.tar.gz
    #     retention-days: 2




name: Intel OneAPI Build and Testing

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build_champ:
    name: Build CHAMP with Intel OneAPI
    runs-on: ubuntu-20.04
    timeout-minutes: 60
    defaults:
      run:
        shell: bash --noprofile --norc {0}
    steps:
    - uses: actions/checkout@v2
    - name: setup repo
      run: |
        wget https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB
        sudo apt-key add GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB
        rm GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB
        sudo add-apt-repository "deb https://apt.repos.intel.com/oneapi all main"
        sudo apt-get update

    - name: Install Cmake and HDF5
      run: |
        sudo apt-get install -y cmake
        sudo apt-get install -y libhdf5-serial-dev

    - name: install Intel oneapi components
      run: |
        sudo apt-get install -y intel-oneapi-common-vars
        sudo apt-get install -y intel-oneapi-compiler-fortran-2021.3.0
        sudo apt-get install -y intel-oneapi-mkl-2021.3.0
        sudo apt-get install -y intel-oneapi-mkl-devel-2021.3.0
        sudo apt-get install -y intel-oneapi-mpi-2021.3.0
        sudo apt-get install -y intel-oneapi-mpi-devel-2021.3.0

    - name: Install Trexio
      run: |
        sudo apt-get install -y cmake
        sudo apt-get install -y libhdf5-serial-dev
        sudo apt-get install -y gfortran
        sudo apt-get install -y gcc
        wget https://github.com/TREX-CoE/trexio/releases/download/v1.0/trexio-1.0.0.tar.gz
        tar -xzf trexio-1.0.0.tar.gz
        cd trexio-1.0.0/
        ./configure FC=gfortran CC=gcc
        make all
        make check
        sudo make install
        sudo cp include/* /usr/local/include/

    - name: Compile the CHAMP code
      run: |
        source /opt/intel/oneapi/setvars.sh
        printenv >> $GITHUB_ENV
        which mpiifort
        MPIRUN=`which mpirun`
        echo "mpirun used is " $MPIRUN
        cmake --version
        cmake -H. -Bbuild -DCMAKE_Fortran_COMPILER=mpiifort
        cmake --build build -- -j2
        ulimit -s unlimited

    - name: "Test 01 (H2) sto basis optimize jastrow sr_n method on 1 processor"
      run: |
        echo "Running the tests using the new parser. H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc.inp -o revised_vmc_single.out -e error

        echo "Comparing the energy with the reference one (total E = -1.0059842 +-  0.0070988) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_single.out "total E" -1.0059842   0.0070988

    - name: "Test 02 (H2) sto basis optimize jastrow sr_n method on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc.inp -o revised_vmc_double.out -e error

        echo "Comparing the energy with the reference one (total E = -1.0108635 +-  0.0054667) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_double.out "total E" -1.0108635  0.0054667

    - name: "Test 03 (H2) sto basis optimize wf+jastrow using lin_d method on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc_davidson_check.inp -o revised_vmc_davidson_check_single.out -e error

        echo "Comparing the energy with the reference one (total E = -1.0629156 +-  0.0032473) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_davidson_check_single.out "total E" -1.0629156  0.0032473

    - name: "Test 04 (H2) sto basis optimize wf+jastrow using lin_d method on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc_davidson_check.inp -o revised_vmc_davidson_check_double.out -e error

        echo "Comparing the energy with the reference one (total E = -1.0588247 +-  0.0022854) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_davidson_check_double.out "total E" -1.0588247  0.0022854

    - name: "Test 05 (H2) sto basis optimize wf+jastrow using lin_d method nopt_iter=20 on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc_lin.inp -o revised_vmc_lin_single.out -e error

        echo "Comparing the energy with the reference one (total E = -1.0616160 +-  0.0029132) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_lin_single.out "total E" -1.0616160   0.0029132

    - name: "Test 06 (H2) sto basis optimize wf+jastrow using lin_d method nopt_iter=20  on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc_lin.inp -o revised_vmc_lin_double.out -e error

        echo "Comparing the energy with the reference one (total E = -1.0546696 +-  0.0021055) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_lin_double.out "total E" -1.0546696   0.0021055

    - name: "Test 07 (H2) corsamp :: sto basis optimize wf+ci+jastrow using linear method nopt_iter=5 on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc_corsamp.inp -o revised_vmc_corsamp_single.out -e error

        echo "Comparing the energy with the reference one (Current energy = -1.0153805 +-  0.0091839 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_corsamp_single.out "Current energy" -1.0153805  0.0091839

        echo "Comparing the energy with the reference one Current best energy + 2*error = -0.9970"
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_corsamp_single.out "Current best energy + 2*error" -0.9970 0.0091839

    - name: "Test 08 (H2) corsamp :: sto basis optimize wf+ci+jastrow using linear method nopt_iter=5 on 2 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. H2 "
        cd tests/CI_test/VMC-H2

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_vmc_corsamp.inp -o revised_vmc_corsamp_double.out -e error

        echo "Comparing the energy with the reference one (Current energy = -1.0125760 +-  0.0065418 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_corsamp_double.out "Current energy" -1.0125760   0.0065418

        echo "Comparing the energy with the reference one Current best energy + 2*error = -0.9995"
        $GITHUB_WORKSPACE/tools/compare_value.py revised_vmc_corsamp_double.out "Current best energy + 2*error" -0.9995 0.0065418


    - name: "Test 09 (Butadiene) Workload DMC on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the DMC tests using the new parser. Butadiene DMC from workload single core"
        cd tests/CI_test/DMC-Butadiene-cipsi500

        echo "Running the dmc.mov1 on one processor"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/dmc.mov1 -i dmc.inp  -o dmc_workload_single.out  -e dmc_single_core.error

        echo "Comparing the energy with the reference one (total energy (  100) = -26.2963582 +-  0.0147048) "
        $GITHUB_WORKSPACE/tools/compare_value.py dmc_workload_single.out "total energy (  100)" -26.2963582  0.0147048


    - name: "Test 10 (Butadiene) Workload DMC on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the DMC tests using the new parser. Butadiene DMC  from workload two cores"
        cd tests/CI_test/DMC-Butadiene-cipsi500

        echo "Running the dmc.mov1 on two processors"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/dmc.mov1 -i dmc.inp  -o dmc_workload_double.out  -e dmc_double_core.error

        echo "Comparing the energy with the reference one (total energy (  100) = -26.2894638 +-  0.0108990) "
        $GITHUB_WORKSPACE/tools/compare_value.py dmc_workload_double.out "total energy (  100)" -26.2894638  0.0108990



    - name: "Test 11 (Butadiene cas44) VMC only on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene/no_optimization_20_dets_12_csf_CAS44

        echo "Running the calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_noopt_cas44.inp  -o vmc_noopt_cas44_single.out  -e error

        echo "Comparing the energy with the reference one (total E = -26.2451712 +-  0.0135854) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_noopt_cas44_single.out "total E" -26.2451712  0.0135854


    - name: "Test 12 (Butadiene cas44) VMC only on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene/no_optimization_20_dets_12_csf_CAS44

        echo "Running the calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_noopt_cas44.inp  -o vmc_noopt_cas44_double.out  -e error

        echo "Comparing the energy with the reference one (total E = -26.2437305 +-  0.0094375) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_noopt_cas44_double.out "total E" -26.2437305  0.0094375


    - name: "Test 13 (Butadiene) VMC optimization + node cutoff including geometry and csfmap using sr_n (500 determinants) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene/optimize_ci_jas_orb_geom_20_dets

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_sr_opt_geom.inp  -o vmc_sr_opt_geom.out  -e error_vmc_sr_opt_geom

        echo "Comparing the energy with the reference one (total E = -26.0351322 +-  0.0175014) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_sr_opt_geom.out "total E" -26.0351322   0.0175014

    - name: "Test 14 (Butadiene) VMC optimization + node cutoff including geometry and csfmap using sr_n (500 determinants) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene/optimize_ci_jas_orb_geom_20_dets

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_sr_opt_geom.inp  -o vmc_sr_opt_geom.out  -e error_vmc_sr_opt_geom

        echo "Comparing the energy with the reference one (total E = -25.8785330 +-  0.0122797) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_sr_opt_geom.out "total E" -25.8785330  0.0122797


    - name: "Test 15 (Butadiene) Workload VMC optimization all using sr_n (500 determinants) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-0.5k-5k-15k-45k-dets/butadiene_cipsi500_T_optWF

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_500.inp  -o vmc_optimization_500.out  -e error_vmc_optimization_500

        echo "Comparing the energy with the reference one (total E = -26.2109125 +-  0.0273542) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_500.out "total E" -26.2109125   0.0273542


    - name: "Test 16 (Butadiene) Workload VMC optimization all using sr_n (500 determinants) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-0.5k-5k-15k-45k-dets/butadiene_cipsi500_T_optWF

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_500.inp  -o vmc_optimization_500.out  -e error_vmc_optimization_500

        echo "Comparing the energy with the reference one (total E = -26.2221839 +-  0.0204738 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_500.out "total E" -26.2221839  0.0204738


    - name: "Test 17 (Butadiene) Workload VMC optimization all using sr_n (5000 determinants) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-0.5k-5k-15k-45k-dets/butadiene_cipsi5k_T_optWF

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_5000.inp  -o vmc_optimization_5000_single.out  -e error_vmc_optimization_5000

        echo "Comparing the energy with the reference one (total E = -26.1980419 +-  0.0179055) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_5000_single.out "total E" -26.1980419   0.0179055


    - name: "Test 18 (Butadiene) Workload VMC optimization all using sr_n (5000 determinants) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-0.5k-5k-15k-45k-dets/butadiene_cipsi5k_T_optWF

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_5000.inp  -o vmc_optimization_5000_double.out  -e error_vmc_optimization_5000

        echo "Comparing the energy with the reference one (total E = -26.2155447 +-  0.0222729) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_5000_double.out "total E" -26.2155447   0.0222729

    - name: "Test 19 (Butadiene) Workload VMC optimization all using sr_n (15000 determinants) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-0.5k-5k-15k-45k-dets/butadiene_cipsi15k_T_optWF

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_15000.inp  -o vmc_optimization_15000.out  -e error_vmc_optimization_15000

        echo "Comparing the energy with the reference one (total E = -26.2175954 +-  0.0237214) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_15000.out "total E" -26.2175954  0.0237214

    - name: "Test 20 (Butadiene) Workload VMC optimization all using sr_n (15000 determinants) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-0.5k-5k-15k-45k-dets/butadiene_cipsi15k_T_optWF

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_15000.inp  -o vmc_optimization_15000.out  -e error_vmc_optimization_15000

        echo "Comparing the energy with the reference one (total E = -26.2314751 +-  0.0195221) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_15000.out "total E" -26.2314751  0.0195221

    - name: "Test 21 (Butadiene) Workload VMC optimization all using sr_n (15000 determinants with 3body Jastrow) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-0.5k-5k-15k-45k-dets/butadiene_cipsi15k_T_optWF_3body

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_15000_3body.inp  -o vmc_optimization_15000_3body.out  -e error_vmc_optimization_15000_3body

        echo "Comparing the energy with the reference one (total E = -26.1936851 +-  0.0261391) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_15000_3body.out "total E" -26.1936851  0.0261391


    - name: "Test 22 (Butadiene) Workload VMC optimization all using sr_n (15000 determinants with 3body Jastrow) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-0.5k-5k-15k-45k-dets/butadiene_cipsi15k_T_optWF_3body

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_15000_3body.inp  -o vmc_optimization_15000_3body.out  -e error_vmc_optimization_15000_3body

        echo "Comparing the energy with the reference one (total E = -26.2470439 +-  0.0209539) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_15000_3body.out "total E" -26.2470439   0.0209539

    - name: "Test 23 (Butadiene) Workload VMC optimization all using sr_n (45000 dets, 8300 csf, 426 orbs) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-0.5k-5k-15k-45k-dets/butadiene_ras1022_Q_optWF+geo

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_45000.inp  -o vmc_optimization_45000_single.out  -e error

        echo "Comparing the energy with the reference one (total E = -26.2197041 +-  0.0244883) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_45000_single.out "total E" -26.2197041   0.0244883

    - name: "Test 24 (Butadiene) Workload VMC optimization all using sr_n (45000 dets, 8300 csf, 426 orbs) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. Butadiene VMC "
        cd tests/CI_test/VMC-Butadiene-0.5k-5k-15k-45k-dets/butadiene_ras1022_Q_optWF+geo

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_45000.inp  -o vmc_optimization_45000_double.out  -e error

        echo "Comparing the energy with the reference one (total E = -26.1195553 +-  0.0197477 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_45000_double.out "total E" -26.1195553  0.0197477


    - name: "Test 25 (psb3) optimize wavefunction and ci using sr_n (400 determinants, 2 states, csfmap) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. PSB3 "
        cd tests/CI_test/VMC-PSB3-400_dets-175_csfs

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_sr_n.inp -o revised_sr_n_single.out -e error

        echo "Comparing the energy with the reference one (total E of second state = -42.6455836 +-  0.0396994  ) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_sr_n_single.out "total E" -42.6455836  0.0396994

    - name: "Test 26 (psb3) optimize wavefunction and ci using sr_n (400 determinants, 2 states, csfmap) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. PSB3 "
        cd tests/CI_test/VMC-PSB3-400_dets-175_csfs

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_sr_n.inp -o revised_sr_n_double.out -e error

        echo "Comparing the energy with the reference one (total E of second state = -42.6712854 +-  0.0325136) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_sr_n_double.out "total E" -42.6712854  0.0325136


    - name: "Test 27 (psb3) optimize wavefunction and ci using lin_d method Regterg Calculation (400 determinants, 2 states, csfmap) on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. PSB3 "
        cd tests/CI_test/VMC-PSB3-400_dets-175_csfs

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_regterg.inp -o revised_regterg_single.out -e error

        echo "Comparing the energy with the reference one (total E of second state = -41.4620412 +-  0.0449123 ) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_regterg_single.out "total E" -41.4620412  0.0449123

    - name: "Test 28 (psb3) optimize wavefunction and ci using lin_d method Regterg Calculation (400 determinants, 2 states, csfmap) on 2 processors"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. PSB3 "
        ulimit -s unlimited
        cd tests/CI_test/VMC-PSB3-400_dets-175_csfs

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_regterg.inp -o revised_regterg_double.out -e error

        echo "Comparing the energy with the reference one (total E of second state = -41.1650052 +-  0.0294303  ) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_regterg_double.out "total E" -41.1650052   0.0294303


    - name: "Test 29 (psb2) optimize wfn, ci, jas, and orb using mix_n method on 1 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. PSB2 "
        cd tests/CI_test/VMC-PSB2-36_dets-20_csfs

        echo "Running the optimization calculation"
        mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_psb2_mix_n.inp -o revised_psb2_mix_n_single.out -e error

        echo "Comparing the energy with the reference one ("total E" -29.9838632 +-  0.0191250) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_psb2_mix_n_single.out "total E" -29.9838632   0.0191250


    - name: "Test 30 (psb2) optimize wfn, ci, jas, and orb using mix_n method on 2 processor"
      run: |
        ulimit -s unlimited
        echo "Running the tests using the new parser. PSB2 "
        cd tests/CI_test/VMC-PSB2-36_dets-20_csfs

        echo "Running the optimization calculation"
        mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i revised_psb2_mix_n.inp -o revised_psb2_mix_n_double.out -e error

        echo "Comparing the energy with the reference one ("total E" -29.9501745 +-  0.0137810) "
        $GITHUB_WORKSPACE/tools/compare_value.py revised_psb2_mix_n_double.out "total E" -29.9501745  0.0137810

    # - name: "Test 31 (Butadiene) TREXIO interface testing with HDF5 backend on 1 processor"
    #   run: |
    #     ulimit -s unlimited
    #     echo "Running the tests using the new parser. Butadiene VMC 500 dets"
    #     cd tests/CI_test/TREXIO

    #     echo "Running the calculation with trexio library linked"
    #     mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_500_hdf5.inp  -o vmc_optimization_500_hdf5_single.out  -e error

    #     echo "Comparing the energy with the reference one (total E = -26.2164721 +-  0.0280294) "
    #     $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_500_hdf5_single.out "total E" -26.2164721  0.0280294

    # - name: "Test 32 (Butadiene) TREXIO interface testing with HDF5 backend on 2 processor"
    #   run: |
    #     ulimit -s unlimited
    #     echo "Running the tests using the new parser. Butadiene VMC 500 dets"
    #     cd tests/CI_test/TREXIO

    #     echo "Running the calculation with trexio library linked"
    #     mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_500_hdf5.inp  -o vmc_optimization_500_hdf5_double.out  -e error

    #     echo "Comparing the energy with the reference one (total E = -26.1862817 +-  0.0180068) "
    #     $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_500_hdf5_double.out "total E" -26.1862817  0.0180068

    # - name: "Test 33 (Butadiene) TREXIO interface testing with TEXT backend on 1 processor"
    #   run: |
    #     ulimit -s unlimited
    #     echo "Running the tests using the new parser. Butadiene VMC 500 dets"
    #     cd tests/CI_test/TREXIO

    #     echo "Running the calculation with trexio library linked"
    #     mpirun -np 1  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_500_text.inp  -o vmc_optimization_500_text_single.out  -e error

    #     echo "Comparing the energy with the reference one (total E = -26.2164721 +-  0.0280294) "
    #     $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_500_text_single.out "total E" -26.2164721  0.0280294

    # - name: "Test 32 (Butadiene) TREXIO interface testing with TEXT backend on 2 processor"
    #   run: |
    #     ulimit -s unlimited
    #     echo "Running the tests using the new parser. Butadiene VMC 500 dets"
    #     cd tests/CI_test/TREXIO

    #     echo "Running the calculation with trexio library linked"
    #     mpirun -np 2  $GITHUB_WORKSPACE/bin/vmc.mov1 -i vmc_optimization_500_text.inp  -o vmc_optimization_500_text_double.out  -e error

    #     echo "Comparing the energy with the reference one (total E = -26.1862817 +-  0.0180068) "
    #     $GITHUB_WORKSPACE/tools/compare_value.py vmc_optimization_500_text_double.out "total E" -26.1862817  0.0180068

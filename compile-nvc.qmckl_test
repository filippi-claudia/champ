#install trexio with hdf5 
#install qmckl linked to trexio
#set or replace the directories  regarding your installation 
trexio_dir=/home/landinez/Codes/trexio_cpu_gcc/build
qmckl_dir=/home/landinez/Codes/qmckl_gpu_gccnv/_install

module purge
module restore gpu_test
module load ScaLAPACK/2.2.0-gompi-2022a-fb
module load CMake/3.23.1-GCCcore-11.3.0

#this will load gcc compilers and use cublas tourgh the libraries

#cmake -H. -B build \
#    -DCMAKE_Fortran_COMPILER=mpif90 \
#    -DCMAKE_C_COMPILER=mpicc \
#    -DENABLE_GPU=ON \
#    -DENABLE_QMCKL=ON -DQMCKL_FOUND="TRUE" -DQMCKL_INCLUDE_DIR=${qmckl_dir}/include -DQMCKL_LIBRARY=${qmckl_dir}/lib/libqmckl_gpu.so -DENABLE_TREXIO=ON -DTREXIO_FOUND="TRUE" -DTREXIO_INCLUDE_DIR=${trexio_dir}/include -DTREXIO_LIBRARY=${trexio_dir}/lib/libtrexio.so -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON 

#cmake -H. -B build -DCMAKE_BUILD_TYPE="DEBUG" -DCMAKE_Fortran_COMPILER=mpif90 -DCMAKE_C_COMPILER=mpicc -DENABLE_GPU=ON -DENABLE_QMCKL=ON -DQMCKL_FOUND="TRUE" -DQMCKL_INCLUDE_DIR=${qmckl_dir}/include -DQMCKL_LIBRARY=${qmckl_dir}/lib/libqmckl_gpu.so -DENABLE_TREXIO=ON -DTREXIO_FOUND="TRUE" -DTREXIO_INCLUDE_DIR=${trexio_dir}/include -DTREXIO_LIBRARY=${trexio_dir}/lib/libtrexio.so -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON 

#cmake -H. -B build -DCMAKE_BUILD_TYPE="DEBUG" -DCMAKE_Fortran_COMPILER=mpif90 -DCMAKE_C_COMPILER=mpicc -DENABLE_GPU=ON -DENABLE_QMCKL=ON -DQMCKL_FOUND="TRUE" -DQMCKL_INCLUDE_DIR=${qmckl_dir}/include -DQMCKL_LIBRARY=${qmckl_dir}/lib/libqmckl_gpu.so -DENABLE_TREXIO=ON -DTREXIO_FOUND="TRUE" -DTREXIO_INCLUDE_DIR=${trexio_dir}/include -DTREXIO_LIBRARY=${trexio_dir}/lib/libtrexio.so -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON -DCMAKE_Fortran_FLAGS="-lcusolver"

cmake -H. -B build -DCMAKE_BUILD_TYPE="DEBUG" -DCMAKE_Fortran_COMPILER=mpif90 -DCMAKE_C_COMPILER=mpicc -DENABLE_GPU=ON -DENABLE_QMCKL=ON -DQMCKL_FOUND="TRUE" -DQMCKL_INCLUDE_DIR=${qmckl_dir}/include -DQMCKL_LIBRARY=${qmckl_dir}/lib/libqmckl_gpu.so -DENABLE_TREXIO=ON -DTREXIO_FOUND="TRUE" -DTREXIO_INCLUDE_DIR=${trexio_dir}/include -DTREXIO_LIBRARY=${trexio_dir}/lib/libtrexio.so -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON -DCMAKE_Fortran_FLAGS="-fopenmp -foffload=-mgomp  -foffload=-lgfortran"

cmake --build build -j 12 


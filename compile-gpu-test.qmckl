#!/bin/bash
# Install trexio with hdf5
# Install qmckl linked to trexio
# Set the library paths according to your installation

module purge
module load 2022
module load CMake/3.23.1-GCCcore-11.3.0
module load OpenMPI/4.1.4-NVHPC-22.7-CUDA-11.7.0
#module load ScaLAPACK/2.2.0-gompi-2022a-fb
#module load UCX-CUDA/1.12.1-GCCcore-11.3.0-CUDA-11.7.0
#module load gompi/2022a


compiler=mpif90             # 'mpiifort' or 'mpiifx'
trexio_dir=/home/landinez/Codes/trexio_gcc_b/build       # Root directory of TREXIO library
qmckl_dir=/home/landinez/Codes/qmckl_gpu_nvgcc/_install            # Root directory of QMCkl library
#qmckl_dir=/home/landinez/Codes/qmckl_gpu_gcc/_install            # Root directory of QMCkl library

#### #-DCMAKE_Fortran_FLAGS="-mp=gpu,noautopar" \
#  2090 |            nucl_fitcusp_radius(k) = 1.d0/(a_cusp*znuc(iwctype(k)+b_cusp))
#       -DENABLE_GPU=ON \
    
cmake -S. -Bbuild \
      -DCMAKE_Fortran_COMPILER=${compiler} \
      -DCMAKE_Fortran_FLAGS="-mp=gpu,noautopar -Minfo" \
      -DENABLE_TREXIO=ON \
      -DTREXIO_INCLUDE_DIR=${trexio_dir}/include \
      -DTREXIO_LIBRARY=${trexio_dir}/lib/libtrexio.so \
      -DENABLE_QMCKL=ON \
      -DQMCKL_INCLUDE_DIR=${qmckl_dir}/include \
      -DQMCKL_LIBRARY=${qmckl_dir}/lib/libqmckl_gpu.so \

    
    
cmake --build build -j 8 

